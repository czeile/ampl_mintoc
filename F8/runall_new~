#!/bin/bash

##########################################################################


# Äußere Schleife mit Parametern p und Anfangswerten könnte noch verändert werden
# Integration von sed sinnvoll

# Instance-Name
name="F8"

sed -i s/'param nt :='/'#param nt :='/g $name.dat
sed -i s/'param ntperu'/'#param ntperu'/g $name.dat

sed -i s/'param nt      > 0;'/'#param nt      > 0;'/g ../mintocPre.mod
sed -i s/'param ntperu'/'#param ntperu'/g ../mintocPre.mod



Runme()
{
	echo "running Fscript.run";
	echo "running Fscript.run" >> res/tex/log.txt;
	echo "param nt > 0; let nt := ${ntvalues[i]}; param ntperu > 0; let ntperu :=${ntperuvalues[j]}; param runiter; let runiter :=$runiterr;  include Fscript.run;"| ampl 	
	echo "reset;"| ampl
	#mv includeSim.tex tex/includeSim_${ntvalues[i]}_${ntperuvalues[j]}.tex;

#	gnuplot lotka.plot;
#	cd res;
#	ps2pdf14 plot_lotka_relaxed.ps ../tex/lotka_relaxed_$runiterr.pdf; 
#	ps2pdf14 plot_lotka_dual.ps ../tex/lotka_dual_$runiterr.pdf; 
#	ps2pdf14 plot_lotka_SUR.ps ../tex/lotka_SUR_$runiterr.pdf; 
#	ps2pdf14 plot_lotka_ScaledSUR.ps ../tex/lotka_ScaledSUR_$runiterr.pdf; 
#	ps2pdf14 plot_lotka_scaling.ps ../tex/lotka_scaling_$runiterr.pdf; 
#	ps2pdf14 plot_lotka_CIA.ps ../tex/lotka_CIA_$runiterr.pdf; 
#	cd -;
	echo $((runiterr++))
}

#Set the desired discretization range:

ntvalues=(300 600 1200 2400)
ntperuvalues=(50)

#ntvalues=(120 150 300 600 1200 2400 3600 4800 6000 7200) 
#ntperuvalues=(600 400 200 100 50 20 10) 

#ntvalues=(7200) 
#ntperuvalues=(600 400 200 100 50 20 10) 

#ntvalues=(2400 3600 4800 7200 8400) 
#ntperuvalues=(200 100 50 25 20 10 5) 



printf ''  > res/tex/includeSim.tex;
printf '\\newcommand{\\nunt}{%i}\n\\newcommand{\\nuntperu}{%i}\n' ${#ntvalues[@]},   ${#ntperuvalues[@]} > res/tex/includeSim_Dim.tex;

runiterr=1
echo "param runiter > 0; let runiter:=$runiterr;" | ampl

for ((i=0;i<${#ntvalues[@]};i++)); do
printf '\\num\def\\nt%i{%i}\n' $i, ${ntvalues[i]}  >> res/tex/includeSim_Dim.tex;
for ((j=0;j<${#ntperuvalues[@]};j++)); do
	echo
	echo "***Simulation with nt= ${ntvalues[i]} and ntperu=${ntperuvalues[j]}: ***  "
	echo
	if [ "$i" == "$((${#ntvalues[@]}-1))" ]
    		then printf '\\num\def\\ntperu%i{%i}\n' $j, ${ntperuvalues[j]}  >> res/tex/includeSim_Dim.tex;
	fi
	Runme
done
done



echo "Runall logging" > res/tex/log.txt;

sed -i s/'#param nt :='/'param nt :='/g $name.dat
sed -i s/'#param ntperu'/'param ntperu'/g $name.dat

sed -i s/'#param nt      > 0;'/'param nt      > 0;'/g ../mintocPre.mod
sed -i s/'#param ntperu'/'param ntperu'/g ../mintocPre.mod

cd res/tex
pdflatex $name.tex

evince $name.pdf

